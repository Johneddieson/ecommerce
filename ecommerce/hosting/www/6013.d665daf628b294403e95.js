(self.webpackChunkcom_trackingsystem=self.webpackChunkcom_trackingsystem||[]).push([[6013],{6013:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Admintab1PageModule:()=>A});var n=i(8583),r=i(665),a=i(5214),o=i(6476),l=i(8002),s=i(6738),c=i(2329),d=i(3018),u=i(7810),m=i(1562);function g(e,t){if(1&e&&(d.TgZ(0,"ion-item",11),d.TgZ(1,"ion-avatar",12),d._UZ(2,"img",13),d.qZA(),d.TgZ(3,"ion-label"),d.TgZ(4,"h2"),d._uU(5),d.qZA(),d.TgZ(6,"h3"),d._uU(7),d.qZA(),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.TgZ(10,"p"),d._uU(11),d.qZA(),d.TgZ(12,"p"),d._uU(13),d.qZA(),d.TgZ(14,"p"),d._uU(15),d.qZA(),d.TgZ(16,"p"),d._uU(17),d.ALo(18,"currency"),d.qZA(),d.qZA(),d.qZA()),2&e){const e=t.$implicit,i=d.oxw().$implicit;d.xp6(2),d.s9C("src",e.ImageUrl,d.LSH),d.xp6(3),d.hij("Product Name: ",e.ProductName,""),d.xp6(2),d.hij("Email: ",i.Billingemail,""),d.xp6(2),d.hij("Address1: ",i.BillingAddress1,""),d.xp6(2),d.hij("Address2: ",i.BillingAddress2,""),d.xp6(2),d.hij("Phone Number: ",i.BillingPhonenumber,""),d.xp6(2),d.hij("Quantity: ",e.Quantity,""),d.xp6(2),d.hij("Unit Price: ",d.xi3(18,8,e.UnitPrice,"\u20b1"),"")}}function h(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"ion-accordion"),d.TgZ(1,"ion-item",5),d.TgZ(2,"ion-label",6),d._uU(3),d._UZ(4,"br"),d._uU(5),d._UZ(6,"br"),d._uU(7),d.ALo(8,"currency"),d.qZA(),d.qZA(),d.TgZ(9,"ion-list",7),d.YNc(10,g,19,11,"ion-item",8),d.TgZ(11,"ion-button",9),d.NdJ("click",function(){const t=d.CHM(e).$implicit;return d.oxw().approveOrder(t)}),d._uU(12,"Approve Order"),d.qZA(),d.TgZ(13,"ion-button",10),d.NdJ("click",function(){const t=d.CHM(e).$implicit;return d.oxw().cancelOrder(t)}),d._uU(14,"Cancel Order"),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=t.$implicit;d.xp6(3),d.AsE("",e.BillingFirstname," ",e.BillingLastname,""),d.xp6(2),d.hij(" Date Ordered : ",e.Datetime," "),d.xp6(2),d.hij(" Total Amount : ",d.xi3(8,5,e.TotalAmount,"\u20b1")," "),d.xp6(3),d.Q6J("ngForOf",e.OrderDetails)}}const p=[{path:"",component:(()=>{class e{constructor(e,t,i,n,r){this.afstore=e,this.afauth=t,this.router=i,this.currencyPipe=n,this.alertCtrl=r,this.allPendingOrders=[],this.currentStock=[],this.afauth.authState.subscribe(e=>{e&&e.uid&&(this.productReference=this.afstore.collection("Orders",e=>e.where("Status","==","Open")),this.sub=this.productReference.snapshotChanges().pipe((0,l.U)(e=>e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())))).subscribe(e=>{console.log("orders",e),e=(e=e.map((e,t)=>Object.assign({BillingAddress1:e.BillingAddress1,BillingAddress2:e.BillingAddress2,BillingFirstname:e.BillingFirstname,BillingIndexId:e.BillingIndexId,BillingLastname:e.BillingLastname,BillingPhonenumber:e.BillingPhonenumber,Billingemail:e.Billingemail,Datetime:e.Datetime,Status:e.Status,TotalAmount:e.TotalAmount,id:e.id,DatetimeToSort:e.DatetimeToSort,OrderDetails:e.OrderDetails}))).sort((e,t)=>Number(t.DatetimeToSort)-Number(e.DatetimeToSort)),this.allPendingOrders=e}))})}ngOnInit(){}addproduct(){this.alertCtrl.create({header:"Choose",inputs:[{type:"radio",label:"POS",value:"POS"},{type:"radio",label:"View Products",value:"View Products"},{type:"radio",label:"Add Product",value:"Add Product"}],buttons:[{text:"Go",handler:e=>{console.log("data",e),"View Products"==e?this.router.navigateByUrl("/viewproducts"):"Add Product"==e?this.router.navigateByUrl("/add-product"):"POS"==e&&this.router.navigateByUrl("/createpos")}},{text:"Cancel",role:"cancel"}]}).then(e=>{e.present()})}closeAccordion(){this.accordionGroup.value=""}toggleSection(){this.accordionGroup.value="frameworks"}approveOrder(e){this.currentProductStockReference=this.afstore.collection("Products"),this.sub2=this.currentProductStockReference.snapshotChanges().pipe((0,l.U)(e=>e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())))).subscribe(t=>{var i,n=(i=t,e.OrderDetails.map(e=>Object.assign({},Object.assign({},e,{Stock:i.find(t=>t.id===e.id&&t).Stock,Category:e.Category,ImageUrl:e.ImageUrl,ProductName:e.ProductName,Quantity:e.Quantity,UnitPrice:e.UnitPrice,id:e.id}))));this.currentStock=n}),this.alertCtrl.create({header:"Question",message:"Are you sure you want to approve this order?",buttons:[{text:"Yes",handler:()=>{var t=this.currentStock.filter(e=>e.Quantity>e.Stock);if(t.length>0)alert(`Insufficient Stock: \n  ${t.map(function(e){return`${e.ProductName} > ${e.Stock} current stock \n`}).join("\n")}`);else{var i=s(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.doc(`Orders/${e.id}`).update({Status:"Closed"});var n=this.currencyPipe.transform(e.TotalAmount,"",""),r=`Your order has been confirmed by the admin. ${e.OrderDetails.map(function(e){return`${e.ProductName}(${e.Quantity} pcs), Unit price of \u20b1${e.UnitPrice}`}).join(", ")}. Total amount of \u20b1${n}`;this.afstore.collection(`users/${e.BillingIndexId}/notifications`).add({Message:r,Datetime:i,read:!1,remarks:"Your order has been confirmed",DatetimeToSort:new Date}),e.OrderDetails.forEach(e=>{this.afstore.doc(`Products/${e.id}`).update({Stock:c.Z.firestore.FieldValue.increment(-e.Quantity)})}),e.OrderDetails.forEach(t=>{this.afstore.collection("Inventory").add({Quantity:-1*parseInt(t.Quantity),Datetime:i,read:!1,Destination:e.BillingFirstname+" "+e.BillingLastname,ProductName:t.ProductName,UnitPrice:t.UnitPrice,ImageUrl:t.ImageUrl,DatetimeToSort:new Date})}),this.afstore.collection("History").add({BillingAddress1:e.BillingAddress1,BillingAddress2:e.BillingAddress2,BillingFirstname:e.BillingFirstname,BillingIndexId:e.BillingIndexId,BillingLastname:e.BillingLastname,BillingPhonenumber:e.BillingPhonenumber,Billingemail:e.Billingemail,Datetime:e.Datetime,Status:"Closed",TotalAmount:e.TotalAmount,id:e.id,OrderDetails:e.OrderDetails,read:!1,DatetimeToSort:new Date}),this.alertCtrl.create({header:"Success",message:"This order approved successfully",buttons:[{text:"Ok",role:"cancel"}]}).then(e=>{e.present()})}}},{text:"No",role:"cancel"}]}).then(e=>{e.present()})}cancelOrder(e){this.alertCtrl.create({header:"Confirmation",message:"Are you sure you want to cancel this order?",buttons:[{text:"Yes",handler:()=>{this.alertCtrl.create({header:"Remarks",message:"Please add a remarks why you want to cancel this order",inputs:[{name:"remarks",placeholder:"Add a remarks"}],buttons:[{text:"Submit remarks",handler:t=>{var i=s(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.doc(`Orders/${e.id}`).update({Status:"Cancelled"});var n=this.currencyPipe.transform(e.TotalAmount,"",""),r=`Your order has been declined by the admin. ${e.OrderDetails.map(function(e){return`${e.ProductName}(${e.Quantity} pcs), Unit price of \u20b1${e.UnitPrice}`}).join(", ")}. Total amount of \u20b1${n}`;this.afstore.collection(`users/${e.BillingIndexId}/notifications`).add({Message:r,Datetime:i,read:!1,remarks:t.remarks,DatetimeToSort:new Date}),this.afstore.collection("History").add({BillingAddress1:e.BillingAddress1,BillingAddress2:e.BillingAddress2,BillingFirstname:e.BillingFirstname,BillingIndexId:e.BillingIndexId,BillingLastname:e.BillingLastname,BillingPhonenumber:e.BillingPhonenumber,Billingemail:e.Billingemail,Datetime:e.Datetime,Status:"Cancelled",TotalAmount:e.TotalAmount,id:e.id,OrderDetails:e.OrderDetails,DatetimeToSort:new Date}),this.alertCtrl.create({header:"Success",message:"This order cancelled successfully",buttons:[{text:"Ok",role:"cancel"}]}).then(e=>{e.present()})}}]}).then(e=>{e.present()})}},{text:"No",role:"cancel"}]}).then(e=>{e.present()})}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(u.ST),d.Y36(m.zQ),d.Y36(o.F0),d.Y36(n.H9),d.Y36(a.Br))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-admintab1"]],viewQuery:function(e,t){if(1&e&&d.Gf(a.eh,5),2&e){let e;d.iGM(e=d.CRH())&&(t.accordionGroup=e.first)}},decls:9,vars:1,consts:[[1,"toolbar"],["slot","end"],["size","large","name","settings",1,"addproduct",3,"click"],["multiple","true"],[4,"ngFor","ngForOf"],["slot","header","lines","none"],[1,"labelname"],["slot","content"],["lines","none",4,"ngFor","ngForOf"],["size","small","fill","outline","color","success",3,"click"],["size","small","fill","outline","color","danger",3,"click"],["lines","none"],["slot","start"],[3,"src"]],template:function(e,t){1&e&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-buttons",1),d.TgZ(3,"ion-icon",2),d.NdJ("click",function(){return t.addproduct()}),d.qZA(),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5,"All Orders"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"ion-content"),d.TgZ(7,"ion-accordion-group",3),d.YNc(8,h,15,8,"ion-accordion",4),d.qZA(),d.qZA()),2&e&&(d.xp6(8),d.Q6J("ngForOf",t.allPendingOrders))},directives:[a.Gu,a.sr,a.Sm,a.gu,a.wd,a.W2,a.eh,n.sg,a.We,a.Ie,a.Q$,a.q_,a.YG,a.BJ],pipes:[n.H9],styles:[".toolbar[_ngcontent-%COMP%]{height:84px;--background:#69a03a;color:#fff;font-size:20px;line-height:84px}.addproduct[_ngcontent-%COMP%]{cursor:pointer}.addproduct[_ngcontent-%COMP%]:active{color:red}.labeldate[_ngcontent-%COMP%]{font-family:Verdana,Geneva,Tahoma,sans-serif;font-weight:900}.labelname[_ngcontent-%COMP%]{font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif;font-weight:900;font-size:18px;color:#2f0101}.totalamount[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif;font-weight:bolder}ion-accordion.accordion-expanded[_ngcontent-%COMP%]   ion-item[slot=header][_ngcontent-%COMP%]{--background:#69a03a;--color:#fff}"]}),e})()}];let f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[o.Bz.forChild(p)],o.Bz]}),e})(),A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[n.ez,r.u5,a.Pc,f]]}),e})()}}]);